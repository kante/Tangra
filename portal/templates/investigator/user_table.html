{% block user_table %}

<script language="JavaScript">
function toggle_progress_{{study.id}}(source) {
	checkboxes = document.getElementsByName("downloadUserProgress_{{study.id}}");
	for(var i in checkboxes) {
		checkboxes[i].checked = source.checked;
	}
}

function toggle_files_{{study.id}}(source) {
	checkboxes = document.getElementsByName("downloadUserFiles_{{study.id}}");
	for(var i in checkboxes) {
		checkboxes[i].checked = source.checked;
	}
}


function getUserFiles_{{study.id}}(){
	checkedBoxes = document.getElementsByName("downloadUserFiles_{{study.id}}");
	
	var fileUsers = new Array();
	
	for (var i in checkedBoxes) {
		if (checkedBoxes[i].checked == true && checkedBoxes[i].value !== undefined) {
			fileUsers.push(checkedBoxes[i].value);
		}
	}
	
	alert("Getting user files for " + fileUsers + "!");
}

function getUserData_{{study.id}}(){
	checkedBoxes = document.getElementsByName("downloadUserProgress_{{study.id}}");
	
	var progressUsers = new Array();
	
	for (var i in checkedBoxes) {
		if (checkedBoxes[i].checked == true && checkedBoxes[i].value !== undefined) {
			progressUsers.push(checkedBoxes[i].value);
		}
	}
	
	if (progressUsers.length === 0) { 
		alert("You have not selected any users! Please try again.");
	}
	else{	
		var data = { progressUsers: progressUsers, study: "{{study.id}}" };
	    $(function(){
	        $("body").append('<iframe src="/investigator/get_data?'+ $.param(data) + '" style="display: none;" ></iframe>');
	    });
	}	
}

</script>

<div id="user_table_wrapper">
    <table>


        <!-- Button row -->
		<tr class"noFormat">
			<td class="noFormat">&nbsp;</td>

			<td class="noFormat" style="text-align:center">
				<input type="button" onclick="getUserData_{{study.id}}()" value="Get Progress"/>
			</td>

			<td class="noFormat" style="text-align:center">
				<input type="button" onclick="getUserFiles_{{study.id}}()" value="Get Files"/>
			</td>
			
			<td class="noFormat">&nbsp;</td>
			<td class="noFormat">&nbsp;</td>
			<td class="noFormat">&nbsp;</td>
		</tr>
		
		
        <!-- Header row -->
        <tr>
            <!-- <th scope ="col" class="nobg">&nbsp;</th> -->

            <th scope ="col">user info</th>

            <th scope ="col" style="text-align:center">
				<!-- get progress?
								</br> -->
				all: <input type="checkbox" onClick="toggle_progress_{{study.id}}(this)"/>
			</th>

            <th scope ="col" style="text-align:center">
				<!-- get files?
								</br> -->
				all: <input type="checkbox" onClick="toggle_files_{{study.id}}(this)"/>
			</th>
			
            <th scope ="col">
                <a style="color:#6D929B;" href="/investigator/is_online">
                    online
                </a>
            </th> 
            <th scope ="col">
                <a style="color:#6D929B;" href="/investigator/is_late">
                    late
                </a>
            </th>
			
            <!-- <th scope ="col">user info</th> -->

            <th scope ="col">progress</th>
        </tr>
    
        {% for user_data in users %}
            <tr>
                <th width="140px" scope="row" class={% cycle "spec" "specalt" %}>
                    <a style="color:#6D929B;" href="/investigator/view_user/{{ user_data.username }}">
						{{ user_data.username }}
                    </a>
				</th>

                <td width="10px"> 
                    <div style="color:#6D929B; text-align: center">
                        <input type="checkbox" name="downloadUserProgress_{{study.id}}" value="{{user_data.username}}"/>
                    </div>
                </td>

                <td width="10px"> 
                    <div style="color:#6D929B; text-align: center">
                        <input type="checkbox" name="downloadUserFiles_{{study.id}}" value="{{user_data.username}}"/>
                    </div>
                </td>
                
                <td width="22px"> 
                    {% if user_data.is_online %}
                        <img src="../../../media/img/online.gif" width="22" height="22" alt="Online">
                    {% else %}
                        <img src="../../../media/img/offline.gif" width="22" height="22" alt="Offline">
                    {% endif %}
                    
                </td>

				<td width="18px">
                    {% if user_data.is_late %}
                        <img src="../../../media/img/alert.gif" width="22" height="22" alt="Alert">
                    {% else %}
                        &nbsp;
                    {% endif %}
                        
                </td>

                <!-- <td width="150px"> 
                    <a style="color:#6D929B;" href="/investigator/view_user/{{ user_data.username }}">
                        link to user page
                    </a>
                </td> -->
                
                <td> {% include 'progress_bar.html' %} </td>
            </tr>
        {% endfor %}

		
        <!-- Select all row -->
		<!--
		<tr class"noFormat">
			<td class="noFormat">&nbsp;</td>

			<td class="noFormat" style="text-align:center">
				<input type="checkbox" onClick="toggle(this)"><br/>Select All</input>
			</td>
			
			<td class="noFormat">&nbsp;</td>
			<td class="noFormat">&nbsp;</td>
			<td class="noFormat">&nbsp;</td>
			<td class="noFormat">&nbsp;</td>
		</tr>
		-->
    
    </table>
</div> <!--user_table_wrapper-->


{% endblock %}