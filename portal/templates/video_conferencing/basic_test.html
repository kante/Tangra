{% extends 'base.html' %}
{% block content %}

{% load helpers %}


<link href="{{ MEDIA_URL }}css/video_conferencing.css" type="text/css" rel="stylesheet" >
<link href="{{ MEDIA_URL }}css/investigator/user_table.css" type="text/css" rel="stylesheet" >



<script src="http://staging.tokbox.com/v0.91/js/TB.min.js" type="text/javascript" charset="utf-8"></script>
<script>
	// These are the variables that need to be set in Django using the TokBox 
	// server-side API. 

	// It is important that they are set BEFORE you include the video_div.js 
	// script below.

	var apiKey = 1127; // OpenTok sample API key. Replace with your own API key.
	var sessionId = '153975e9d3ecce1d11baddd2c9d8d3c9d147df18'; // Replace with your session ID.
	var token = 'devtoken'; // Should not be hard-coded. Add via python SSL.
</script>
<script src="{{ MEDIA_URL }}js/video_conferencing/open_tok.js" type="text/javascript" charset="utf-8"></script>
<script src="{{ MEDIA_URL }}js/video_conferencing/ajax_requests.js" type="text/javascript" charset="utf-8"></script>

<div class="hidden_data" id="ajax_response">HIDDEN!</div>


<br>

<div id="user_table_wrapper">
<table>
	<!-- Header row -->
	<tr>
		<th scope ="col" class="nobg">users</th> 
		<th scope ="col">is active</th> 
		<th scope ="col">send chat request</th>
	</tr>

	<!-- User rows -->
	{% for user, is_active, has_request in user_status %}
		<!-- tr -->
		{% if is_active %} <tr class="online_tr"> {% else %} <tr>{% endif %}
			<th scope="row" class={% cycle "spec" "specalt" %}> {{ user }} </td>

			<td> {{ is_active }} </td>
			
			{% if is_active %} <td style="background-color:red;"> {% else %} <td>{% endif %}
				{% if is_active %}
					{% if request_declined %}
						user declined request
					{% else %} 
						{%if has_request %}
							<a href="#" onclick="javascript:uninvite_user('{{ user }}')">
								cancel_chat_reuqest
							</a>
						{% else %}
							<a href="#" onclick="javascript:invite_user('{{ user }}')">
								send_chat_request
							</a>
						{% endif %}
					{% endif %}	
				{% else %}
					offline
				{% endif %}
			</td>
			
		</tr>
	{% endfor %}
	
</table>
</div> <!--user_table_wrapper-->


<br><br>


<div id="admin_video_wrapper">
	<div id="opentok_console"></div>
	<table>
		<tr>
			<th> Investigator Video </th>
			<th> Participant Video </th>
		</tr>
		
		<tr>
			<td>
				<div id="myCamera" class="publisherContainer"></div>
			</td>
			<td>
				<div id="subscribers"></div>
			</td>
		</tr>
		
		<tr>
			<td>
				<div id="links">
					<input type="button" value="Connect" id ="connectLink" onClick="javascript:connect()" />
					<input type="button" value="Leave" id ="disconnectLink" onClick="javascript:disconnect()" />
					<input type="button" value="Start Publishing" id ="publishLink" onClick="javascript:startPublishing()" />
					<input type="button" value="Stop Publishing" id ="unpublishLink" onClick="javascript:stopPublishing()" />
				</div>
			</td>
			<td>
				
			</td>
		</tr>
		
	</table>
</div>

<script>
	show('connectLink');
</script>



{% endblock %}


