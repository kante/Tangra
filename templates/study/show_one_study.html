{% extends 'base.html' %}

{% block content %}
	<h1>{{study.name}}</h1>
{% ifequal role 1 %}
  <!--stage menu-->
  <div id="stages_nav">
    <ul>
    {% for astage in stages %} 
		  {% if astage.status > 1  %}
        <li class="not_active"><a href="" id="stage_box_{{forloop.counter}}" onclick="return false;" class="stage_box">{{forloop.counter}}</a></li>
		  {% else %}
			  {% ifequal astage.status 1 %}
			    <li class="active"><a href="" id="stage_box_{{forloop.counter}}" class="stage_box">{{forloop.counter}}</a></li>
			  {% else %}
			    <li class="not_active"><a href="" id="stage_box_{{forloop.counter}}" class="stage_box">{{forloop.counter}}</a></li>
			  {% endifequal %}
		  {% endif %}
	{% endfor%}

  </ul>
  </div>
	<!--stage block-->

  <div id="stage_info">
	{% for astage in stages %}  
    <div id="stage_{{forloop.counter}}" class="stage_panel"
      {% ifnotequal astage.status 1 %}style="display:none;"{% endifnotequal %}>
      <div class="stage_header">
        <span><strong>Stage:</strong> {{astage.stage.name}}</span>
        <a href="" class="button" id="instruction_button_{{forloop.counter}}">Stage Instructions</a>
        <div class="instructions" style="display:none;" id="instructions_{{forloop.counter}}">
          {{astage.stage.instructions}}
        </div>
      </div>
      <p class="stage_description">
        {{astage.stage.description}}
      </p>
      <div class="act_container">
        <a href="{{action}}" class="button">Act</a>
        {%if astage.overdue%}
			    You're overdue!! Bad you!
		    {% else %}
			    Complete by: {{astage.nextdeadline|date:"d M Y"}}
		  {% endif %}
      </div>
      <p>
        {{astage.order}}/{{studypart.number_of_stages}}
        Completed: {{astage.sessions_completed}}/{{astage.stage.sessions}}
      </p>
    </div>
  {% endfor %}
  </div>


{% endifequal %}
{% ifequal role 2 %} 
<!-- Investigator -->
  <div id="stages_nav">
    <ul>
    {% for astage in stages %} 
		  {% if astage.status > 1  %}
        <li class="not_active"><a href="" id="stage_box_{{forloop.counter}}" onclick="return false;" class="stage_box">{{astage.number_of_users}}</a></li>
		  {% else %}
			  {% ifequal forloop.counter 1 %}
			    <li class="active"><a href="" id="stage_box_{{forloop.counter}}" class="stage_box">{{astage.number_of_users}}</a></li>
			  {% else %}
			    <li class="not_active"><a href="" id="stage_box_{{forloop.counter}}" class="stage_box">{{astage.number_of_users}}</a></li>
			  {% endifequal %}
		  {% endif %}
	{% endfor%}
</div>
  </ul>
<div id="stage_info">
  {% for stage in stages %}
    <div id="stage_{{forloop.counter}}" class="stage_panel" {% ifnotequal forloop.counter 1 %}style="display:none;"{% endifnotequal %}>
      <div class="stage_header">
        <h2><strong>Stage: </strong> {{stage.name}} ({{stage.number_of_users}})</h2>
        <a href="" class="button">Manage Everyone</a>
        <a href="" class="button">Stage Instructions</a>
      </div>
      <div class="table_wrapper">
        <table>
          <tr>
            <th> Participant</th>
            <th> Next Deadline </th>
            <th> Actions </th>
          <tr>
        {% for auser in stage.users%}
          <tr>
            <td><a href="">{{auser.user.username}}</a></td>
            <td>
              {% if auser.overdue %}
                <span class="red">{{auser.nextdeadline|date:"d M Y"}}</span>
              {% else %}
                <span class="green">{{auser.nextdeadline|date:"d M Y"}}</span>
              {% endif %}
            </td>
            <td>
              <a href="">Interview</a> |
              <a href="">Stage Complete</a>
            </td>
          <tr>
        {%endfor%}
        </table>
      </div>
    </div>
  {% endfor %}	
</div>



	<!--investigator side
	<p>(<a href="{% url add_participant_to_study study.id %}">add participant</a> | 
	<a href="{% url show_users_in_study study.id %}">show users</a> | 
	<a href="{% url edit_one_study study.id %}">edit</a> |<a href="{% url edit_one_study study.id %}">edit</a> |
	<a href="{% url remove_one_study study.id %}" onclick="confirm('Are you sure?')">Delete</a>)</p>
-->
{% else %}
You are not authorized to view this study.
{% endifequal %}


<!-- this will also have to change depending on investigator/participant -->
<div id="study_manage">
  <button id="left_button"></button>
  <button id="right_button"></button>
  <a href="" class="button">Message Center</a>
  <a href="" class="button">Manage Users</a>
</div>
<div id="study_details">
  <p>{{study.description}}</p>
	<p>{{study.consent}}</p>
	<p>{{study.instructions}}</p>
	<p>{{study.eligibility}}</p>
	<p>{{study.reward}}</p>
</div>


{% endblock %}
